<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Two-sex time-varying kinship model specified by age and stage</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Two-sex time-varying kinship model
specified by age and stage</h1>



<style>

.tocify {
position: fixed;
top: 50px;
right: 0;
width: 240px;
height: calc(100% - 50px);
overflow-y: auto;
margin-left: 0;
padding-left: 0;
}

.main-container {
max-width: calc(100% - 260px);
margin-left: 10px;
margin-right: 250px;
}

.tocify-subheader .tocify-subheader {
display: none;
}

.learning-objectives {
background-color: #e0f7fa;
border-left: 5px solid #00acc1;
padding: 15px;
margin-bottom: 20px;
border-radius: 3px;
}
</style>
<div class="learning-objectives">
<p><strong>Learning Objectives</strong>: In this vignette, you will
learn how to implement a kinship model that combines both two-sex and
time-varying approaches with multiple stages. You will understand how to
incorporate sex-specific demographic rates that change over time,
analyze the effects of demographic transitions on kinship structures by
sex and stage, and explore applications with different stage variables
such as parity and education.</p>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>In this vignette, we explore the most comprehensive kinship model
currently available in the <code>DemoKin</code> package: a
<strong>two-sex time-varying multi-state model</strong>. This model
integrates all the extensions we’ve explored in previous vignettes,
allowing us to analyze kinship networks with unprecedented detail and
realism.</p>
<p>The model accounts for: - Sex differences in mortality and fertility
- Historical changes in demographic rates over time - Stage-based
transitions that reflect different sociodemographic characteristics -
Joint distributions of age, sex, and stage among relatives</p>
<p>By incorporating these multiple dimensions simultaneously, we can
address complex research questions about how kinship networks evolve
across demographic transitions, how they differ by sex, and how they’re
shaped by individual characteristics like parity or education.</p>
<p>Building on Caswell’s earlier work <span class="citation">[@caswell_formal_2019; @caswell_formal_2020;
@caswell_formal_2021; @caswell_formal_2022]</span>, this integrated
approach offers a powerful framework for understanding family structures
in all their complexity.</p>
<div id="preparation" class="section level2">
<h2>Package Installation</h2>
<p>If you haven’t already installed the required packages from the
previous vignettes, here’s what you’ll need:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Install basic data analysis packages</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)     <span class="co"># Data manipulation</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyr&quot;</span>)     <span class="co"># Data tidying</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)   <span class="co"># Data visualization</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;readr&quot;</span>)     <span class="co"># Data import</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;knitr&quot;</span>)     <span class="co"># Document generation</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;data.table&quot;</span>)<span class="co"># Efficient data handling</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;Matrix&quot;</span>)    <span class="co"># Matrix operations</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co"># Install DemoKin</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co"># DemoKin is available on CRAN (https://cran.r-project.org/web/packages/DemoKin/index.html), </span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co"># but we&#39;ll use the development version on GitHub (https://github.com/IvanWilli/DemoKin):</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;IvanWilli/DemoKin&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="load-packages" class="section level1">
<h1>Setting Up the Analysis Environment</h1>
<p>Let’s load the necessary packages for our analysis:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)    <span class="co"># For data manipulation</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">library</span>(tidyr)    <span class="co"># For restructuring data</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">library</span>(ggplot2)  <span class="co"># For visualization</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="fu">library</span>(readr)    <span class="co"># For reading data</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="fu">library</span>(knitr)    <span class="co"># For document generation</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="fu">library</span>(DemoKin)  <span class="co"># For kinship analysis</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="fu">library</span>(Matrix)   <span class="co"># For matrix operations</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="fu">library</span>(tictoc)   <span class="co"># For timing operations</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>) <span class="co"># hide summarise output</span></span></code></pre></div>
</div>
<div id="two-sex-time-varying-multi-state" class="section level1">
<h1>Two-Sex Time-Varying Multi-State Models</h1>
<p>The <code>kin_multi_stage_time_variant_2sex</code> function in the
<code>DemoKin</code> package allows us to implement a comprehensive
kinship model that accounts for sex, time, and stage simultaneously.
This function computes stage-specific kinship networks across both sexes
for an average member of a population (focal) under time-varying
demographic rates.</p>
<p>The model estimates: - The number of relatives of each type - The age
distribution of relatives - The sex distribution of relatives - The
stage distribution of relatives - How these distributions change over
the life course of Focal - How they vary by Focal’s birth cohort</p>
<div id="model-requirements" class="section level2">
<h2>Model Components and Requirements</h2>
<p>The two-sex time-varying multi-state model requires several
inputs:</p>
<ol style="list-style-type: decimal">
<li><strong>Sex-specific mortality rates by stage over time</strong>:
How survival probabilities differ between males and females of different
stages across historical periods</li>
<li><strong>Sex-specific fertility rates by stage over time</strong>:
How fertility patterns differ between males and females of different
stages across historical periods</li>
<li><strong>Sex-specific transition rates between stages over
time</strong>: How individuals move between stages at each age,
potentially differing by sex</li>
<li><strong>Sex ratio at birth</strong>: The proportion of births that
are female</li>
<li><strong>Birth redistribution matrices</strong>: How newborns are
distributed across stages</li>
<li><strong>Sex and initial stage of the focal individual</strong>: The
characteristics of the person whose kin network we’re analyzing</li>
</ol>
<p>In the following sections, we’ll explore two examples of this model
using different stage variables: parity and education.</p>
</div>
</div>
<div id="parity-as-stage" class="section level1">
<h1>Example 1: Parity as the Stage Variable</h1>
<div id="parity-data-preparation" class="section level2">
<h2>Data Preparation</h2>
<p>In our first example, we’ll use parity (number of children already
born) as our stage variable. We’ll use data from the United Kingdom
ranging from 1965 to 2022, sourced from the Human Mortality Database and
the Office for National Statistics.</p>
<p>Due to data limitations, we make some simplifying assumptions:</p>
<ol style="list-style-type: decimal">
<li>Fertility rates vary with time and parity but are the same across
sexes (the “androgynous approximation”)</li>
<li>Mortality rates vary with time and sex but are the same across
parity classes</li>
<li>Parity progression probabilities vary with time but are the same
across sexes</li>
</ol>
<p>Let’s load the pre-processed UK data:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Load pre-processed data for UK</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>F_mat_fem <span class="ot">&lt;-</span> Female_parity_fert_list_UK       <span class="co"># Female fertility by parity</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>F_mat_male <span class="ot">&lt;-</span> Female_parity_fert_list_UK      <span class="co"># Male fertility (same as female due to androgynous approximation)</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>T_mat_fem <span class="ot">&lt;-</span> Parity_transfers_by_age_list_UK  <span class="co"># Female parity transitions</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>T_mat_male <span class="ot">&lt;-</span> Parity_transfers_by_age_list_UK <span class="co"># Male parity transitions (same as female)</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>U_mat_fem <span class="ot">&lt;-</span> Female_parity_mortality_list_UK  <span class="co"># Female survival</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>U_mat_male <span class="ot">&lt;-</span> Male_parity_mortality_list_UK   <span class="co"># Male survival</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>H_mat <span class="ot">&lt;-</span> Redistribution_by_parity_list_UK     <span class="co"># Birth redistribution matrices</span></span></code></pre></div>
</div>
<div id="parity-model-running" class="section level2">
<h2>Running the Parity Model</h2>
<p>Now let’s implement the two-sex time-varying multi-state model with
parity as the stage variable:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Define time period and parameters</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>no_years <span class="ot">&lt;-</span> <span class="dv">40</span>  <span class="co"># Run the model for 40 years (1965-2005)</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># Run the model</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>kin_out_1965_2005 <span class="ot">&lt;-</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="fu">kin_multi_stage_time_variant_2sex</span>(</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="at">U_list_females =</span> U_mat_fem[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],        <span class="co"># Female survival matrices</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="at">U_list_males =</span> U_mat_male[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],         <span class="co"># Male survival matrices</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    <span class="at">F_list_females =</span> F_mat_fem[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],        <span class="co"># Female fertility matrices</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>    <span class="at">F_list_males =</span> F_mat_male[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],         <span class="co"># Male fertility matrices</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>    <span class="at">T_list_females =</span> T_mat_fem[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],        <span class="co"># Female transition matrices</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>    <span class="at">T_list_males =</span> T_mat_fem[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],          <span class="co"># Male transition matrices</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>    <span class="at">H_list =</span> H_mat[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],                    <span class="co"># Birth redistribution matrices</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>    <span class="at">birth_female =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.51</span>,                           <span class="co"># UK sex ratio (49% female)</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>    <span class="at">parity =</span> <span class="cn">TRUE</span>,                                      <span class="co"># Stages represent parity</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>    <span class="at">output_kin =</span> <span class="fu">c</span>(<span class="st">&quot;d&quot;</span>, <span class="st">&quot;oa&quot;</span>, <span class="st">&quot;ys&quot;</span>, <span class="st">&quot;os&quot;</span>),             <span class="co"># Selected kin types</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>    <span class="at">summary_kin =</span> <span class="cn">TRUE</span>,                                 <span class="co"># Produce summary statistics</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>    <span class="at">sex_Focal =</span> <span class="st">&quot;Female&quot;</span>,                               <span class="co"># Focal is female</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>    <span class="at">initial_stage_Focal =</span> <span class="dv">1</span>,                            <span class="co"># Focal starts at parity 0</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>    <span class="at">output_years =</span> <span class="fu">c</span>(<span class="dv">1965</span>, <span class="dv">1975</span>, <span class="dv">1985</span>, <span class="dv">1995</span>, <span class="dv">2005</span>)     <span class="co"># Selected output years</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>  )</span></code></pre></div>
<blockquote>
<p>Note: This model run takes approximately 10 minutes to complete. For
the purpose of this vignette, we’ll assume it has already been run.</p>
</blockquote>
</div>
<div id="parity-kin-counts" class="section level2">
<h2>Analyzing Kin Counts by Parity</h2>
<p>Let’s examine the structure of the output:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">head</span>(kin_out_1965_2005<span class="sc">$</span>kin_summary)</span></code></pre></div>
<p>The output includes: - <code>age_focal</code>: Age of the focal
individual - <code>kin_stage</code>: Stage (parity) of the relatives -
<code>sex_kin</code>: Sex of the relatives - <code>year</code>: Calendar
year of observation - <code>group</code>: Type of relative (d =
children, oa = older aunts/uncles, etc.) - <code>count</code>: Expected
number of living relatives - <code>cohort</code>: Birth cohort of the
focal individual</p>
<div id="parity-period-analysis" class="section level3">
<h3>Period Analysis of Kin by Parity</h3>
<p>Let’s visualize the distribution of older aunts and uncles by parity
for different ages of Focal across different calendar years:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>kin_out_1965_2005<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">&quot;oa&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_focal, <span class="at">y =</span> count, <span class="at">color =</span> stage_kin, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="fu">facet_grid</span>(sex_kin <span class="sc">~</span> year) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Parity distribution of older aunts and uncles by Focal&#39;s age&quot;</span>,</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;United Kingdom, 1965-2005&quot;</span>,</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age of focal individual&quot;</span>,</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Number of older aunts and uncles&quot;</span>,</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Parity&quot;</span>,</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Parity&quot;</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>  )</span></code></pre></div>
<p>Now let’s examine the distribution of children by parity:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>kin_out_1965_2005<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">&quot;d&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_focal, <span class="at">y =</span> count, <span class="at">color =</span> stage_kin, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="fu">facet_grid</span>(sex_kin <span class="sc">~</span> year) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Parity distribution of children by Focal&#39;s age&quot;</span>,</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;United Kingdom, 1965-2005&quot;</span>,</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age of focal individual&quot;</span>,</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Number of children&quot;</span>,</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Parity&quot;</span>,</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Parity&quot;</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="parity-cohort-analysis" class="section level3">
<h3>Cohort Analysis of Kin by Parity</h3>
<p>We can also examine the kinship networks of specific birth cohorts.
Let’s compare the offspring parity distributions for three different
cohorts (1910, 1925, and 1965):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>kin_out_1965_2005<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">&quot;d&quot;</span>, cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1910</span>, <span class="dv">1925</span>, <span class="dv">1965</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_focal, <span class="at">y =</span> count, <span class="at">color =</span> stage_kin, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="fu">facet_grid</span>(sex_kin <span class="sc">~</span> cohort) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Parity distribution of offspring by birth cohort&quot;</span>,</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;United Kingdom, ages observed between 1965-2005&quot;</span>,</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age of focal individual&quot;</span>,</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Number of offspring&quot;</span>,</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Parity&quot;</span>,</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Parity&quot;</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>  )</span></code></pre></div>
<p><strong>Interpretation</strong>: - The 1910 cohort (observed at ages
55-95): Most offspring have already completed their childbearing,
showing a mix of parity states - The 1925 cohort (observed at ages
40-80): Offspring are observed during and after their reproductive years
- The 1965 cohort (observed at ages 0-40): Initially, all offspring are
in parity 0, gradually transitioning to higher parities as they age</p>
</div>
</div>
<div id="parity-age-distribution" class="section level2">
<h2>Age Distribution of Kin by Parity</h2>
<p>For more detailed analysis, we can examine the age and parity
distribution of specific relatives. Let’s look at the younger siblings
of a 50-year-old Focal across different years:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>kin_out_1965_2005<span class="sc">$</span>kin_full <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">&quot;ys&quot;</span>,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>         age_focal <span class="sc">==</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_kin, <span class="at">y =</span> count, <span class="at">color =</span> stage_kin, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="fu">facet_grid</span>(sex_kin <span class="sc">~</span> year) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Age and parity distribution of younger siblings&quot;</span>,</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;For a 50-year-old focal individual, United Kingdom, 1965-2005&quot;</span>,</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age of sibling&quot;</span>,</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Number of younger siblings&quot;</span>,</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Parity&quot;</span>,</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Parity&quot;</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>  )</span></code></pre></div>
<p>And now let’s look at the older siblings:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>kin_out_1965_2005<span class="sc">$</span>kin_full <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">&quot;os&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>         age_focal <span class="sc">==</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_kin, <span class="at">y =</span> count, <span class="at">color =</span> stage_kin, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="fu">facet_grid</span>(sex_kin <span class="sc">~</span> year) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Age and parity distribution of older siblings&quot;</span>,</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;For a 50-year-old focal individual, United Kingdom, 1965-2005&quot;</span>,</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age of sibling&quot;</span>,</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Number of older siblings&quot;</span>,</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Parity&quot;</span>,</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Parity&quot;</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>  )</span></code></pre></div>
<p>We can also combine these to examine all siblings:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>kin_out_1965_2005<span class="sc">$</span>kin_full <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="fu">filter</span>((group <span class="sc">==</span> <span class="st">&quot;ys&quot;</span> <span class="sc">|</span> group <span class="sc">==</span> <span class="st">&quot;os&quot;</span>),</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>         age_focal <span class="sc">==</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> group, <span class="at">values_from =</span> count) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="st">`</span><span class="at">ys</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">os</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_kin, <span class="at">y =</span> count, <span class="at">color =</span> stage_kin, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  <span class="fu">facet_grid</span>(sex_kin <span class="sc">~</span> year) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Age and parity distribution of all siblings&quot;</span>,</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;For a 50-year-old focal individual, United Kingdom, 1965-2005&quot;</span>,</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age of sibling&quot;</span>,</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Number of siblings&quot;</span>,</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Parity&quot;</span>,</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Parity&quot;</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>  )</span></code></pre></div>
</div>
</div>
<div id="education-as-stage" class="section level1">
<h1>Example 2: Education as the Stage Variable</h1>
<div id="education-data-preparation" class="section level2">
<h2>Data Preparation</h2>
<p>In our second example, we’ll use educational attainment as our stage
variable. We’ll use data from Singapore ranging from 2020 to 2090,
sourced from the Wittgenstein Center. The data is aggregated into 5-year
age groups and 5-year time intervals.</p>
<p>Let’s load the pre-processed Singapore data:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Load pre-processed educational data for Singapore</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;../data/singapore_edu.rdata&quot;</span>)</span></code></pre></div>
</div>
<div id="education-model-running" class="section level2">
<h2>Running the Education Model</h2>
<p>Now let’s implement the two-sex time-varying multi-state model with
education as the stage variable:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Define time period and parameters</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>time_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2020</span>, <span class="dv">2090</span>, <span class="dv">5</span>)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>no_years <span class="ot">&lt;-</span> <span class="fu">length</span>(time_range) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>output_year_select <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, no_years <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co"># Run the model</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>kin_out_2020_2090 <span class="ot">&lt;-</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>  <span class="fu">kin_multi_stage_time_variant_2sex</span>(</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>    <span class="at">U_list_females =</span> U_mat_fem_edu[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],     <span class="co"># Female survival matrices</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>    <span class="at">U_list_males =</span> U_mat_male_edu[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],      <span class="co"># Male survival matrices</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>    <span class="at">F_list_females =</span> F_mat_fem_edu[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],     <span class="co"># Female fertility matrices</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>    <span class="at">F_list_males =</span> F_mat_male_edu[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],      <span class="co"># Male fertility matrices</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>    <span class="at">T_list_females =</span> T_mat_fem_edu[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],     <span class="co"># Female transition matrices</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>    <span class="at">T_list_males =</span> T_mat_fem_edu[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],       <span class="co"># Male transition matrices</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>    <span class="at">H_list =</span> H_mat_edu[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>no_years)],                 <span class="co"># Birth redistribution matrices</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>    <span class="at">birth_female =</span> <span class="dv">1</span><span class="sc">/</span>(<span class="fl">1.06</span><span class="sc">+</span><span class="dv">1</span>),                          <span class="co"># Singapore sex ratio (48.5% female)</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>    <span class="at">parity =</span> <span class="cn">FALSE</span>,                                      <span class="co"># Stages represent education</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>    <span class="at">summary_kin =</span> <span class="cn">TRUE</span>,                                  <span class="co"># Produce summary statistics</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>    <span class="at">sex_Focal =</span> <span class="st">&quot;Female&quot;</span>,                                <span class="co"># Focal is female</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>    <span class="at">initial_stage_Focal =</span> <span class="dv">1</span>,                             <span class="co"># Focal starts with no education</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>    <span class="at">output_years =</span> output_year_select                    <span class="co"># All years</span></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>  )</span></code></pre></div>
<blockquote>
<p>Note: This model run takes approximately 5 minutes to complete. For
the purpose of this vignette, we’ll assume it has already been run.</p>
</blockquote>
<p>Now we need to recode the stage variables to show meaningful
educational labels:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># Recode year and age variables to show correct values</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_summary <span class="ot">&lt;-</span> </span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  kin_out_2020_2090<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> (year<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">5</span><span class="sc">+</span><span class="fu">min</span>(time_range),</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>         <span class="at">age_focal =</span> age_focal<span class="sc">*</span><span class="dv">5</span>,</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>         <span class="at">cohort =</span> year <span class="sc">-</span> age_focal,</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>         <span class="at">stage_kin =</span> <span class="fu">factor</span>(stage_kin, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>                         <span class="st">&quot;no education&quot;</span>,</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>                         <span class="st">&quot;incomplete primary&quot;</span>,</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>                         <span class="st">&quot;primary&quot;</span>,</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>                         <span class="st">&quot;lower secondary&quot;</span>,</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>                         <span class="st">&quot;upper secondary&quot;</span>,</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>                         <span class="st">&quot;post-secondary&quot;</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>                       )))</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_full <span class="ot">&lt;-</span> </span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>  kin_out_2020_2090<span class="sc">$</span>kin_full <span class="sc">%&gt;%</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> (year<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">5</span><span class="sc">+</span><span class="fu">min</span>(time_range),</span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>         <span class="at">age_focal =</span> age_focal<span class="sc">*</span><span class="dv">5</span>,</span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>         <span class="at">age_kin =</span> age_kin<span class="sc">*</span><span class="dv">5</span>,</span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>         <span class="at">cohort =</span> year <span class="sc">-</span> age_focal,</span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a>         <span class="at">stage_kin =</span> <span class="fu">factor</span>(stage_kin, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a>                         <span class="st">&quot;no education&quot;</span>,</span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a>                         <span class="st">&quot;incomplete primary&quot;</span>,</span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a>                         <span class="st">&quot;primary&quot;</span>,</span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a>                         <span class="st">&quot;lower secondary&quot;</span>,</span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a>                         <span class="st">&quot;upper secondary&quot;</span>,</span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a>                         <span class="st">&quot;post-secondary&quot;</span></span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a>                       )))</span></code></pre></div>
</div>
<div id="education-kin-analysis" class="section level2">
<h2>Analyzing Kin by Educational Attainment</h2>
<p>Let’s examine the structure of the output:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_summary[<span class="dv">1000</span><span class="sc">:</span><span class="dv">1010</span>, ]</span></code></pre></div>
<div id="education-cohort-analysis" class="section level3">
<h3>Cohort Analysis of Kin by Education</h3>
<p>First, let’s visualize the total number of living kin by educational
attainment for a woman born in 2020 in Singapore:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="co"># Exclude Focal from the analysis</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">!=</span> <span class="st">&quot;Focal&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  <span class="fu">filter</span>(cohort <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">kin =</span> group) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>  <span class="fu">rename_kin</span>(<span class="at">sex =</span> <span class="st">&quot;2sex&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count), <span class="at">.by =</span> <span class="fu">c</span>(stage_kin, age_focal)) <span class="sc">%&gt;%</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_focal, <span class="at">y =</span> count, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Total living kin by educational attainment over the life course&quot;</span>,</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;For a woman born in 2020, Singapore&quot;</span>,</span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Expected number of living kin&quot;</span>,</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age of focal individual&quot;</span>,</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Educational attainment&quot;</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p>Now let’s look at specific types of relatives:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;d&quot;</span>, <span class="st">&quot;gd&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;gm&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="fu">filter</span>(cohort <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">kin =</span> group) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  <span class="fu">rename_kin</span>(<span class="at">sex =</span> <span class="st">&quot;2sex&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count), <span class="at">.by =</span> <span class="fu">c</span>(kin_label, stage_kin, age_focal)) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_focal, <span class="at">y =</span> count, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Living kin by educational attainment over the life course&quot;</span>,</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;For a woman born in 2020, Singapore&quot;</span>,</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Expected number of living kin&quot;</span>,</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age of focal individual&quot;</span>,</span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Educational attainment&quot;</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> kin_label) <span class="sc">+</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p>Let’s examine the age and educational distribution of key relatives
when the focal individual is 60 years old:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_full <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>    group <span class="sc">%in%</span>  <span class="fu">c</span>(<span class="st">&quot;d&quot;</span>, <span class="st">&quot;gd&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;gm&quot;</span>),</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>    age_focal <span class="sc">==</span> <span class="dv">60</span>,</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>    cohort <span class="sc">==</span> <span class="dv">2020</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">kin =</span> group) <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>  <span class="fu">rename_kin</span>(<span class="st">&quot;2sex&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_kin, <span class="at">y =</span> count, <span class="at">color =</span> stage_kin, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Age and educational distribution of key relatives&quot;</span>,</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;For a 60-year-old woman born in 2020, Singapore&quot;</span>,</span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age of relative&quot;</span>,</span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Number of relatives&quot;</span>,</span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Educational attainment&quot;</span>,</span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Educational attainment&quot;</span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> kin_label) <span class="sc">+</span></span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="education-period-analysis" class="section level3">
<h3>Period Analysis of Kin by Education</h3>
<p>Now let’s examine how the educational composition of specific
relatives changes over time. First, let’s look at the educational
attainment of descendants (children and grandchildren) of 60-year-old
women across different calendar years:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>    group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;d&quot;</span>, <span class="st">&quot;gd&quot;</span>),</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>    age_focal <span class="sc">==</span> <span class="dv">60</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">kin =</span> group) <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>  <span class="fu">rename_kin</span>(<span class="at">sex =</span> <span class="st">&quot;2sex&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count), <span class="at">.by =</span> <span class="fu">c</span>(stage_kin, kin_label, year)) <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> count, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Educational attainment of descendants over time&quot;</span>,</span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;For women aged 60, Singapore, 2020-2090&quot;</span>,</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Expected number of descendants&quot;</span>,</span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Educational attainment&quot;</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> kin_label) <span class="sc">+</span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p>Finally, let’s examine the educational attainment of parents and
grandparents of newborn women over time:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>kin_out_2020_2090<span class="sc">$</span>kin_summary <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>    group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;gm&quot;</span>),</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>    age_focal <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">kin =</span> group) <span class="sc">%&gt;%</span> </span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  <span class="fu">rename_kin</span>(<span class="at">sex =</span> <span class="st">&quot;2sex&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count), <span class="at">.by =</span> <span class="fu">c</span>(stage_kin, kin_label, year)) <span class="sc">%&gt;%</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> count, <span class="at">fill =</span> stage_kin)) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Educational attainment of parents and grandparents over time&quot;</span>,</span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;For newborn women, Singapore, 2020-2090&quot;</span>,</span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Expected number of ancestors&quot;</span>,</span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Educational attainment&quot;</span></span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> kin_label) <span class="sc">+</span></span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="limitations" class="section level1">
<h1>Limitations and Assumptions</h1>
<p>When implementing these models, we’ve made several simplifying
assumptions due to data limitations:</p>
<p>For the UK parity model: 1. Fertility rates vary with time and parity
but are the same across sexes 2. Mortality rates vary with time and sex
but are the same across parity classes 3. Parity progression
probabilities vary with time but are the same across sexes</p>
<p>For the Singapore education model: 1. Fertility rates vary over time
and by education but are identical for both sexes 2. Age-specific
education transition probabilities vary over time but not by sex 3.
Educational transitions for young children follow Singapore’s Compulsory
Education Act 4. Demographic rates before 2020 are assumed stable
(time-invariant)</p>
<p>These assumptions should be kept in mind when interpreting the
results.</p>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>In this vignette, we’ve explored the implementation of two-sex
time-varying multi-state kinship models using the <code>DemoKin</code>
package. These comprehensive models allow us to analyze kinship networks
with unprecedented detail, accounting for sex differences, temporal
changes, and individual characteristics simultaneously.</p>
<p>Key insights include:</p>
<ol style="list-style-type: decimal">
<li>The joint distribution of age, sex, and stage provides a rich
picture of kinship networks</li>
<li>Different stage variables (like parity or education) reveal
different aspects of family structure</li>
<li>Cohort and period perspectives offer complementary insights into
kinship dynamics</li>
<li>Educational expansion and fertility transitions reshape the
composition of kin networks in complex ways</li>
</ol>
<p>These advanced models have numerous applications in demography,
sociology, and public policy, including: - Understanding
intergenerational transmission of socioeconomic status - Analyzing care
needs and support networks across diverse populations - Projecting
future family structures in the context of educational expansion -
Examining how demographic transitions reshape the educational
composition of families</p>
<p>The <code>kin_multi_stage_time_variant_2sex</code> function provides
a powerful tool for researchers interested in these complex questions
about family and kinship in changing societies.</p>
</div>
<div id="references" class="section level1">
<h1>References</h1>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
