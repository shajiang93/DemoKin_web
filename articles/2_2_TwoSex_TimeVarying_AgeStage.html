<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Two-sex time-varying kinship model specified by age and stage • DemoKin</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Two-sex time-varying kinship model specified by age and stage">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DemoKin</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-models-by-age" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Models by Age</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-models-by-age">
<li><a class="dropdown-item" href="../articles/1_1_OneSex_TimeInvariant_Age.html">One-sex time-invariant model</a></li>
    <li><a class="dropdown-item" href="../articles/1_2_OneSex_TimeVarying_Age.html">One-sex time-varying model</a></li>
    <li><a class="dropdown-item" href="../articles/1_3_TwoSex_TimeInvariant_Age.html">Two-sex time-invariant model</a></li>
    <li><a class="dropdown-item" href="../articles/1_4_TwoSex_TimeVarying_Age.html">Two-sex time-varying model</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-models-by-age-and-stage" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Models by Age and Stage</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-models-by-age-and-stage">
<li><a class="dropdown-item" href="../articles/2_1_OneSex_TimeInvariant_AgeStage.html">One-sex time-invariant model</a></li>
    <li><a class="dropdown-item" href="../articles/2_2_TwoSex_TimeVarying_AgeStage.html">Two-sex time-varying model</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/shajiang93/DemoKin_web"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Two-sex time-varying kinship model specified by age and stage</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/shajiang93/DemoKin_web/blob/main/vignettes/2_2_TwoSex_TimeVarying_AgeStage.Rmd" class="external-link"><code>vignettes/2_2_TwoSex_TimeVarying_AgeStage.Rmd</code></a></small>
      <div class="d-none name"><code>2_2_TwoSex_TimeVarying_AgeStage.Rmd</code></div>
    </div>

    
    
<style>
/* Make TOC appear on the right side */
.tocify {
  position: fixed;
  top: 50px;
  right: 0;
  width: 240px;
  height: calc(100% - 50px);
  overflow-y: auto;
  margin-left: 0;
  padding-left: 0;
}

/* Adjust main content to make room for right-side TOC */
.main-container {
  max-width: calc(100% - 260px);
  margin-left: 10px;
  margin-right: 250px;
}

/* Limit TOC to only show 2 levels */
.tocify-subheader .tocify-subheader {
  display: none;
}

/* Style for learning objectives box */
.learning-objectives {
  background-color: #e0f7fa;
  border-left: 5px solid #00acc1;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 3px;
}
</style>
<div class="learning-objectives">
<p><strong>Learning Objectives</strong>: In this vignette, you will
learn how to implement a kinship model that combines both two-sex and
time-varying approaches with multiple stages. You will understand how to
incorporate sex-specific demographic rates that change over time,
analyze the effects of demographic transitions on kinship structures by
sex and stage, and explore applications with different stage variables
such as parity and education.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, we explore the most comprehensive kinship model
currently available in the <code>DemoKin</code> package: a
<strong>two-sex time-varying multi-state model</strong>. This model
integrates all the extensions we’ve explored in previous vignettes,
allowing us to analyze kinship networks with unprecedented detail and
realism.</p>
<p>The model accounts for: - Sex differences in mortality and fertility
- Historical changes in demographic rates over time - Stage-based
transitions that reflect different sociodemographic characteristics -
Joint distributions of age, sex, and stage among relatives</p>
<p>By incorporating these multiple dimensions simultaneously, we can
address complex research questions about how kinship networks evolve
across demographic transitions, how they differ by sex, and how they’re
shaped by individual characteristics like parity or education.</p>
<p>Building on Caswell’s earlier work <span class="citation">[@caswell_formal_2019; @caswell_formal_2020;
@caswell_formal_2021; @caswell_formal_2022]</span>, this integrated
approach offers a powerful framework for understanding family structures
in all their complexity.</p>
<div class="section level3">
<h3 id="preparation">Package Installation<a class="anchor" aria-label="anchor" href="#preparation"></a>
</h3>
<p>If you haven’t already installed the required packages from the
previous vignettes, here’s what you’ll need:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install basic data analysis packages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span>     <span class="co"># Data manipulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tidyr"</span><span class="op">)</span>     <span class="co"># Data tidying</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span>   <span class="co"># Data visualization</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"readr"</span><span class="op">)</span>     <span class="co"># Data import</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"knitr"</span><span class="op">)</span>     <span class="co"># Document generation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"data.table"</span><span class="op">)</span><span class="co"># Efficient data handling</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"Matrix"</span><span class="op">)</span>    <span class="co"># Matrix operations</span></span>
<span></span>
<span><span class="co"># Install DemoKin</span></span>
<span><span class="co"># DemoKin is available on CRAN (https://cran.r-project.org/web/packages/DemoKin/index.html), </span></span>
<span><span class="co"># but we'll use the development version on GitHub (https://github.com/IvanWilli/DemoKin):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"IvanWilli/DemoKin"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="load-packages">Setting Up the Analysis Environment<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h2>
<p>Let’s load the necessary packages for our analysis:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>    <span class="co"># For data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>    <span class="co"># For restructuring data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>  <span class="co"># For visualization</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span>    <span class="co"># For reading data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span>    <span class="co"># For document generation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shajiang93.github.io/DemoKin_web/">DemoKin</a></span><span class="op">)</span>  <span class="co"># For kinship analysis</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org" class="external-link">Matrix</a></span><span class="op">)</span>   <span class="co"># For matrix operations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jabiru/tictoc" class="external-link">tictoc</a></span><span class="op">)</span>   <span class="co"># For timing operations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>dplyr.summarise.inform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># hide summarise output</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="two-sex-time-varying-multi-state">Two-Sex Time-Varying Multi-State Models<a class="anchor" aria-label="anchor" href="#two-sex-time-varying-multi-state"></a>
</h2>
<p>The <code>kin_multi_stage_time_variant_2sex</code> function in the
<code>DemoKin</code> package allows us to implement a comprehensive
kinship model that accounts for sex, time, and stage simultaneously.
This function computes stage-specific kinship networks across both sexes
for an average member of a population (focal) under time-varying
demographic rates.</p>
<p>The model estimates: - The number of relatives of each type - The age
distribution of relatives - The sex distribution of relatives - The
stage distribution of relatives - How these distributions change over
the life course of Focal - How they vary by Focal’s birth cohort</p>
<div class="section level3">
<h3 id="model-requirements">Model Components and Requirements<a class="anchor" aria-label="anchor" href="#model-requirements"></a>
</h3>
<p>The two-sex time-varying multi-state model requires several
inputs:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Sex-specific mortality rates by stage over time</strong>:
How survival probabilities differ between males and females of different
stages across historical periods</li>
<li>
<strong>Sex-specific fertility rates by stage over time</strong>:
How fertility patterns differ between males and females of different
stages across historical periods</li>
<li>
<strong>Sex-specific transition rates between stages over
time</strong>: How individuals move between stages at each age,
potentially differing by sex</li>
<li>
<strong>Sex ratio at birth</strong>: The proportion of births that
are female</li>
<li>
<strong>Birth redistribution matrices</strong>: How newborns are
distributed across stages</li>
<li>
<strong>Sex and initial stage of the focal individual</strong>: The
characteristics of the person whose kin network we’re analyzing</li>
</ol>
<p>In the following sections, we’ll explore two examples of this model
using different stage variables: parity and education.</p>
</div>
</div>
<div class="section level2">
<h2 id="parity-as-stage">Example 1: Parity as the Stage Variable<a class="anchor" aria-label="anchor" href="#parity-as-stage"></a>
</h2>
<div class="section level3">
<h3 id="parity-data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#parity-data-preparation"></a>
</h3>
<p>In our first example, we’ll use parity (number of children already
born) as our stage variable. We’ll use data from the United Kingdom
ranging from 1965 to 2022, sourced from the Human Mortality Database and
the Office for National Statistics.</p>
<p>Due to data limitations, we make some simplifying assumptions:</p>
<ol style="list-style-type: decimal">
<li>Fertility rates vary with time and parity but are the same across
sexes (the “androgynous approximation”)</li>
<li>Mortality rates vary with time and sex but are the same across
parity classes</li>
<li>Parity progression probabilities vary with time but are the same
across sexes</li>
</ol>
<p>Let’s load the pre-processed UK data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load pre-processed data for UK</span></span>
<span><span class="va">F_mat_fem</span> <span class="op">&lt;-</span> <span class="va">Female_parity_fert_list_UK</span>       <span class="co"># Female fertility by parity</span></span>
<span><span class="va">F_mat_male</span> <span class="op">&lt;-</span> <span class="va">Female_parity_fert_list_UK</span>      <span class="co"># Male fertility (same as female due to androgynous approximation)</span></span>
<span><span class="va">T_mat_fem</span> <span class="op">&lt;-</span> <span class="va">Parity_transfers_by_age_list_UK</span>  <span class="co"># Female parity transitions</span></span>
<span><span class="va">T_mat_male</span> <span class="op">&lt;-</span> <span class="va">Parity_transfers_by_age_list_UK</span> <span class="co"># Male parity transitions (same as female)</span></span>
<span><span class="va">U_mat_fem</span> <span class="op">&lt;-</span> <span class="va">Female_parity_mortality_list_UK</span>  <span class="co"># Female survival</span></span>
<span><span class="va">U_mat_male</span> <span class="op">&lt;-</span> <span class="va">Male_parity_mortality_list_UK</span>   <span class="co"># Male survival</span></span>
<span><span class="va">H_mat</span> <span class="op">&lt;-</span> <span class="va">Redistribution_by_parity_list_UK</span>     <span class="co"># Birth redistribution matrices</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parity-model-running">Running the Parity Model<a class="anchor" aria-label="anchor" href="#parity-model-running"></a>
</h3>
<p>Now let’s implement the two-sex time-varying multi-state model with
parity as the stage variable:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define time period and parameters</span></span>
<span><span class="va">no_years</span> <span class="op">&lt;-</span> <span class="fl">40</span>  <span class="co"># Run the model for 40 years (1965-2005)</span></span>
<span></span>
<span><span class="co"># Run the model</span></span>
<span><span class="va">kin_out_1965_2005</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">kin_multi_stage_time_variant_2sex</span><span class="op">(</span></span>
<span>    U_list_females <span class="op">=</span> <span class="va">U_mat_fem</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,        <span class="co"># Female survival matrices</span></span>
<span>    U_list_males <span class="op">=</span> <span class="va">U_mat_male</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,         <span class="co"># Male survival matrices</span></span>
<span>    F_list_females <span class="op">=</span> <span class="va">F_mat_fem</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,        <span class="co"># Female fertility matrices</span></span>
<span>    F_list_males <span class="op">=</span> <span class="va">F_mat_male</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,         <span class="co"># Male fertility matrices</span></span>
<span>    T_list_females <span class="op">=</span> <span class="va">T_mat_fem</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,        <span class="co"># Female transition matrices</span></span>
<span>    T_list_males <span class="op">=</span> <span class="va">T_mat_fem</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,          <span class="co"># Male transition matrices</span></span>
<span>    H_list <span class="op">=</span> <span class="va">H_mat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,                    <span class="co"># Birth redistribution matrices</span></span>
<span>    birth_female <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">0.51</span>,                           <span class="co"># UK sex ratio (49% female)</span></span>
<span>    parity <span class="op">=</span> <span class="cn">TRUE</span>,                                      <span class="co"># Stages represent parity</span></span>
<span>    output_kin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"oa"</span>, <span class="st">"ys"</span>, <span class="st">"os"</span><span class="op">)</span>,             <span class="co"># Selected kin types</span></span>
<span>    summary_kin <span class="op">=</span> <span class="cn">TRUE</span>,                                 <span class="co"># Produce summary statistics</span></span>
<span>    sex_Focal <span class="op">=</span> <span class="st">"Female"</span>,                               <span class="co"># Focal is female</span></span>
<span>    initial_stage_Focal <span class="op">=</span> <span class="fl">1</span>,                            <span class="co"># Focal starts at parity 0</span></span>
<span>    output_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1965</span>, <span class="fl">1975</span>, <span class="fl">1985</span>, <span class="fl">1995</span>, <span class="fl">2005</span><span class="op">)</span>     <span class="co"># Selected output years</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<blockquote>
<p>Note: This model run takes approximately 10 minutes to complete. For
the purpose of this vignette, we’ll assume it has already been run.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="parity-kin-counts">Analyzing Kin Counts by Parity<a class="anchor" aria-label="anchor" href="#parity-kin-counts"></a>
</h3>
<p>Let’s examine the structure of the output:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_summary</span><span class="op">)</span></span></code></pre></div>
<p>The output includes: - <code>age_focal</code>: Age of the focal
individual - <code>kin_stage</code>: Stage (parity) of the relatives -
<code>sex_kin</code>: Sex of the relatives - <code>year</code>: Calendar
year of observation - <code>group</code>: Type of relative (d =
children, oa = older aunts/uncles, etc.) - <code>count</code>: Expected
number of living relatives - <code>cohort</code>: Birth cohort of the
focal individual</p>
<div class="section level4">
<h4 id="parity-period-analysis">Period Analysis of Kin by Parity<a class="anchor" aria-label="anchor" href="#parity-period-analysis"></a>
</h4>
<p>Let’s visualize the distribution of older aunts and uncles by parity
for different ages of Focal across different calendar years:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"oa"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_focal</span>, y <span class="op">=</span> <span class="va">count</span>, color <span class="op">=</span> <span class="va">stage_kin</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">sex_kin</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">70</span>,<span class="fl">80</span>,<span class="fl">90</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Parity distribution of older aunts and uncles by Focal's age"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"United Kingdom, 1965-2005"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of focal individual"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of older aunts and uncles"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Parity"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Parity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Now let’s examine the distribution of children by parity:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"d"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_focal</span>, y <span class="op">=</span> <span class="va">count</span>, color <span class="op">=</span> <span class="va">stage_kin</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">sex_kin</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">70</span>,<span class="fl">80</span>,<span class="fl">90</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Parity distribution of children by Focal's age"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"United Kingdom, 1965-2005"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of focal individual"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of children"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Parity"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Parity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="parity-cohort-analysis">Cohort Analysis of Kin by Parity<a class="anchor" aria-label="anchor" href="#parity-cohort-analysis"></a>
</h4>
<p>We can also examine the kinship networks of specific birth cohorts.
Let’s compare the offspring parity distributions for three different
cohorts (1910, 1925, and 1965):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"d"</span>, <span class="va">cohort</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1910</span>, <span class="fl">1925</span>, <span class="fl">1965</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_focal</span>, y <span class="op">=</span> <span class="va">count</span>, color <span class="op">=</span> <span class="va">stage_kin</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">sex_kin</span> <span class="op">~</span> <span class="va">cohort</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Parity distribution of offspring by birth cohort"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"United Kingdom, ages observed between 1965-2005"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of focal individual"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of offspring"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Parity"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Parity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><strong>Interpretation</strong>: - The 1910 cohort (observed at ages
55-95): Most offspring have already completed their childbearing,
showing a mix of parity states - The 1925 cohort (observed at ages
40-80): Offspring are observed during and after their reproductive years
- The 1965 cohort (observed at ages 0-40): Initially, all offspring are
in parity 0, gradually transitioning to higher parities as they age</p>
</div>
</div>
<div class="section level3">
<h3 id="parity-age-distribution">Age Distribution of Kin by Parity<a class="anchor" aria-label="anchor" href="#parity-age-distribution"></a>
</h3>
<p>For more detailed analysis, we can examine the age and parity
distribution of specific relatives. Let’s look at the younger siblings
of a 50-year-old Focal across different years:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"ys"</span>,</span>
<span>         <span class="va">age_focal</span> <span class="op">==</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_kin</span>, y <span class="op">=</span> <span class="va">count</span>, color <span class="op">=</span> <span class="va">stage_kin</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">sex_kin</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">70</span>,<span class="fl">80</span>,<span class="fl">90</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Age and parity distribution of younger siblings"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For a 50-year-old focal individual, United Kingdom, 1965-2005"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of sibling"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of younger siblings"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Parity"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Parity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>And now let’s look at the older siblings:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"os"</span>,</span>
<span>         <span class="va">age_focal</span> <span class="op">==</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_kin</span>, y <span class="op">=</span> <span class="va">count</span>, color <span class="op">=</span> <span class="va">stage_kin</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">sex_kin</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">70</span>,<span class="fl">80</span>,<span class="fl">90</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Age and parity distribution of older siblings"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For a 50-year-old focal individual, United Kingdom, 1965-2005"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of sibling"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of older siblings"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Parity"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Parity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We can also combine these to examine all siblings:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"ys"</span> <span class="op">|</span> <span class="va">group</span> <span class="op">==</span> <span class="st">"os"</span><span class="op">)</span>,</span>
<span>         <span class="va">age_focal</span> <span class="op">==</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">group</span>, values_from <span class="op">=</span> <span class="va">count</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>count <span class="op">=</span> <span class="va">`ys`</span> <span class="op">+</span> <span class="va">`os`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_kin</span>, y <span class="op">=</span> <span class="va">count</span>, color <span class="op">=</span> <span class="va">stage_kin</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">sex_kin</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">70</span>,<span class="fl">80</span>,<span class="fl">90</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Age and parity distribution of all siblings"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For a 50-year-old focal individual, United Kingdom, 1965-2005"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of sibling"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of siblings"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Parity"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Parity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="education-as-stage">Example 2: Education as the Stage Variable<a class="anchor" aria-label="anchor" href="#education-as-stage"></a>
</h2>
<div class="section level3">
<h3 id="education-data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#education-data-preparation"></a>
</h3>
<p>In our second example, we’ll use educational attainment as our stage
variable. We’ll use data from Singapore ranging from 2020 to 2090,
sourced from the Wittgenstein Center. The data is aggregated into 5-year
age groups and 5-year time intervals.</p>
<p>Let’s load the pre-processed Singapore data:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load pre-processed educational data for Singapore</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"../data/singapore_edu.rdata"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="education-model-running">Running the Education Model<a class="anchor" aria-label="anchor" href="#education-model-running"></a>
</h3>
<p>Now let’s implement the two-sex time-varying multi-state model with
education as the stage variable:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define time period and parameters</span></span>
<span><span class="va">time_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">2090</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">no_years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">time_range</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">output_year_select</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">no_years</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the model</span></span>
<span><span class="va">kin_out_2020_2090</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">kin_multi_stage_time_variant_2sex</span><span class="op">(</span></span>
<span>    U_list_females <span class="op">=</span> <span class="va">U_mat_fem_edu</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,     <span class="co"># Female survival matrices</span></span>
<span>    U_list_males <span class="op">=</span> <span class="va">U_mat_male_edu</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,      <span class="co"># Male survival matrices</span></span>
<span>    F_list_females <span class="op">=</span> <span class="va">F_mat_fem_edu</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,     <span class="co"># Female fertility matrices</span></span>
<span>    F_list_males <span class="op">=</span> <span class="va">F_mat_male_edu</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,      <span class="co"># Male fertility matrices</span></span>
<span>    T_list_females <span class="op">=</span> <span class="va">T_mat_fem_edu</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,     <span class="co"># Female transition matrices</span></span>
<span>    T_list_males <span class="op">=</span> <span class="va">T_mat_fem_edu</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,       <span class="co"># Male transition matrices</span></span>
<span>    H_list <span class="op">=</span> <span class="va">H_mat_edu</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,                 <span class="co"># Birth redistribution matrices</span></span>
<span>    birth_female <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1.06</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,                          <span class="co"># Singapore sex ratio (48.5% female)</span></span>
<span>    parity <span class="op">=</span> <span class="cn">FALSE</span>,                                      <span class="co"># Stages represent education</span></span>
<span>    summary_kin <span class="op">=</span> <span class="cn">TRUE</span>,                                  <span class="co"># Produce summary statistics</span></span>
<span>    sex_Focal <span class="op">=</span> <span class="st">"Female"</span>,                                <span class="co"># Focal is female</span></span>
<span>    initial_stage_Focal <span class="op">=</span> <span class="fl">1</span>,                             <span class="co"># Focal starts with no education</span></span>
<span>    output_years <span class="op">=</span> <span class="va">output_year_select</span>                    <span class="co"># All years</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<blockquote>
<p>Note: This model run takes approximately 5 minutes to complete. For
the purpose of this vignette, we’ll assume it has already been run.</p>
</blockquote>
<p>Now we need to recode the stage variables to show meaningful
educational labels:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Recode year and age variables to show correct values</span></span>
<span><span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="op">(</span><span class="va">year</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">5</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">time_range</span><span class="op">)</span>,</span>
<span>         age_focal <span class="op">=</span> <span class="va">age_focal</span><span class="op">*</span><span class="fl">5</span>,</span>
<span>         cohort <span class="op">=</span> <span class="va">year</span> <span class="op">-</span> <span class="va">age_focal</span>,</span>
<span>         stage_kin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stage_kin</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                         <span class="st">"no education"</span>,</span>
<span>                         <span class="st">"incomplete primary"</span>,</span>
<span>                         <span class="st">"primary"</span>,</span>
<span>                         <span class="st">"lower secondary"</span>,</span>
<span>                         <span class="st">"upper secondary"</span>,</span>
<span>                         <span class="st">"post-secondary"</span></span>
<span>                       <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_full</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="op">(</span><span class="va">year</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">5</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">time_range</span><span class="op">)</span>,</span>
<span>         age_focal <span class="op">=</span> <span class="va">age_focal</span><span class="op">*</span><span class="fl">5</span>,</span>
<span>         age_kin <span class="op">=</span> <span class="va">age_kin</span><span class="op">*</span><span class="fl">5</span>,</span>
<span>         cohort <span class="op">=</span> <span class="va">year</span> <span class="op">-</span> <span class="va">age_focal</span>,</span>
<span>         stage_kin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stage_kin</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                         <span class="st">"no education"</span>,</span>
<span>                         <span class="st">"incomplete primary"</span>,</span>
<span>                         <span class="st">"primary"</span>,</span>
<span>                         <span class="st">"lower secondary"</span>,</span>
<span>                         <span class="st">"upper secondary"</span>,</span>
<span>                         <span class="st">"post-secondary"</span></span>
<span>                       <span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="education-kin-analysis">Analyzing Kin by Educational Attainment<a class="anchor" aria-label="anchor" href="#education-kin-analysis"></a>
</h3>
<p>Let’s examine the structure of the output:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_summary</span><span class="op">[</span><span class="fl">1000</span><span class="op">:</span><span class="fl">1010</span>, <span class="op">]</span></span></code></pre></div>
<div class="section level4">
<h4 id="education-cohort-analysis">Cohort Analysis of Kin by Education<a class="anchor" aria-label="anchor" href="#education-cohort-analysis"></a>
</h4>
<p>First, let’s visualize the total number of living kin by educational
attainment for a woman born in 2020 in Singapore:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Exclude Focal from the analysis</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">!=</span> <span class="st">"Focal"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>kin <span class="op">=</span> <span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">rename_kin</span><span class="op">(</span>sex <span class="op">=</span> <span class="st">"2sex"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stage_kin</span>, <span class="va">age_focal</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_focal</span>, y <span class="op">=</span> <span class="va">count</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_area</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Total living kin by educational attainment over the life course"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For a woman born in 2020, Singapore"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Expected number of living kin"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of focal individual"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Educational attainment"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s look at specific types of relatives:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"gd"</span>, <span class="st">"m"</span>, <span class="st">"gm"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>kin <span class="op">=</span> <span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">rename_kin</span><span class="op">(</span>sex <span class="op">=</span> <span class="st">"2sex"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">kin_label</span>, <span class="va">stage_kin</span>, <span class="va">age_focal</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_focal</span>, y <span class="op">=</span> <span class="va">count</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_area</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Living kin by educational attainment over the life course"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For a woman born in 2020, Singapore"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Expected number of living kin"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of focal individual"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Educational attainment"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">kin_label</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s examine the age and educational distribution of key relatives
when the focal individual is 60 years old:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"gd"</span>, <span class="st">"m"</span>, <span class="st">"gm"</span><span class="op">)</span>,</span>
<span>    <span class="va">age_focal</span> <span class="op">==</span> <span class="fl">60</span>,</span>
<span>    <span class="va">cohort</span> <span class="op">==</span> <span class="fl">2020</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>kin <span class="op">=</span> <span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">rename_kin</span><span class="op">(</span><span class="st">"2sex"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_kin</span>, y <span class="op">=</span> <span class="va">count</span>, color <span class="op">=</span> <span class="va">stage_kin</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">70</span>,<span class="fl">80</span>,<span class="fl">90</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Age and educational distribution of key relatives"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For a 60-year-old woman born in 2020, Singapore"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of relative"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of relatives"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Educational attainment"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Educational attainment"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">kin_label</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="education-period-analysis">Period Analysis of Kin by Education<a class="anchor" aria-label="anchor" href="#education-period-analysis"></a>
</h4>
<p>Now let’s examine how the educational composition of specific
relatives changes over time. First, let’s look at the educational
attainment of descendants (children and grandchildren) of 60-year-old
women across different calendar years:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"gd"</span><span class="op">)</span>,</span>
<span>    <span class="va">age_focal</span> <span class="op">==</span> <span class="fl">60</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>kin <span class="op">=</span> <span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">rename_kin</span><span class="op">(</span>sex <span class="op">=</span> <span class="st">"2sex"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stage_kin</span>, <span class="va">kin_label</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">count</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_area</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Educational attainment of descendants over time"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For women aged 60, Singapore, 2020-2090"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Expected number of descendants"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Educational attainment"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">kin_label</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, let’s examine the educational attainment of parents and
grandparents of newborn women over time:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"gm"</span><span class="op">)</span>,</span>
<span>    <span class="va">age_focal</span> <span class="op">==</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>kin <span class="op">=</span> <span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">rename_kin</span><span class="op">(</span>sex <span class="op">=</span> <span class="st">"2sex"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stage_kin</span>, <span class="va">kin_label</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">count</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_area</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Educational attainment of parents and grandparents over time"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For newborn women, Singapore, 2020-2090"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Expected number of ancestors"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Educational attainment"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">kin_label</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="limitations">Limitations and Assumptions<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h2>
<p>When implementing these models, we’ve made several simplifying
assumptions due to data limitations:</p>
<p>For the UK parity model: 1. Fertility rates vary with time and parity
but are the same across sexes 2. Mortality rates vary with time and sex
but are the same across parity classes 3. Parity progression
probabilities vary with time but are the same across sexes</p>
<p>For the Singapore education model: 1. Fertility rates vary over time
and by education but are identical for both sexes 2. Age-specific
education transition probabilities vary over time but not by sex 3.
Educational transitions for young children follow Singapore’s Compulsory
Education Act 4. Demographic rates before 2020 are assumed stable
(time-invariant)</p>
<p>These assumptions should be kept in mind when interpreting the
results.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>In this vignette, we’ve explored the implementation of two-sex
time-varying multi-state kinship models using the <code>DemoKin</code>
package. These comprehensive models allow us to analyze kinship networks
with unprecedented detail, accounting for sex differences, temporal
changes, and individual characteristics simultaneously.</p>
<p>Key insights include:</p>
<ol style="list-style-type: decimal">
<li>The joint distribution of age, sex, and stage provides a rich
picture of kinship networks</li>
<li>Different stage variables (like parity or education) reveal
different aspects of family structure</li>
<li>Cohort and period perspectives offer complementary insights into
kinship dynamics</li>
<li>Educational expansion and fertility transitions reshape the
composition of kin networks in complex ways</li>
</ol>
<p>These advanced models have numerous applications in demography,
sociology, and public policy, including: - Understanding
intergenerational transmission of socioeconomic status - Analyzing care
needs and support networks across diverse populations - Projecting
future family structures in the context of educational expansion -
Examining how demographic transitions reshape the educational
composition of families</p>
<p>The <code>kin_multi_stage_time_variant_2sex</code> function provides
a powerful tool for researchers interested in these complex questions
about family and kinship in changing societies.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Your Name.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
